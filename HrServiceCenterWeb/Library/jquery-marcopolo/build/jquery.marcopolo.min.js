/*!
 * jQuery UI Widget 1.8.21
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}})(jQuery);

/*!
 * Marco Polo v1.8.1
 *
 * A jQuery autocomplete plugin for the discerning developer.
 *
 * https://github.com/jstayton/jquery-marcopolo
 *
 * Copyright 2014 by Justin Stayton
 * Licensed MIT
 */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}}(function($,undefined){var cache={};$.widget("mp.marcoPolo",{options:{cache:true,compare:false,data:{},delay:250,formatData:null,formatError:function(){return"<em>查询出错，请稍后再试</em>"},formatItem:function(data){return data.title||data.name},formatMinChars:function(minChars){return"<em>你的查询不能少于 <strong>"+minChars+"</strong> 个字符。</em>"},formatNoResults:function(q){return"<em>查询<strong>"+q+"</strong>没有返回结果。</em>"},hideOnSelect:true,highlight:true,label:null,minChars:3,onBlur:null,onChange:null,onError:null,onFocus:null,onMinChars:null,onNoResults:null,onRequestBefore:null,onRequestAfter:null,onResults:null,onSelect:function(data){this.val(data.title||data.name)},param:"q",required:false,selectable:"*",selected:null,submitOnEnter:false,url:null},keys:{DOWN:40,END:35,ENTER:13,ESC:27,HOME:36,TAB:9,UP:38},_create:function(){var self=this,$input;self.$input=$input=self.element.addClass("mp_input");self.inputName="mp_"+($input.attr("name")||$.now());self.$list=$('<ol class="mp_list" />').attr({"aria-atomic":"true","aria-busy":"false","aria-live":"polite","id":self.inputName+"_list","role":"listbox"}).hide().insertAfter(self.$input);self.inputOriginals={"aria-activedescendant":$input.attr("aria-activedescendant"),"aria-autocomplete":$input.attr("aria-autocomplete"),"aria-expanded":$input.attr("aria-expanded"),"aria-labelledby":$input.attr("aria-labelledby"),"aria-owns":$input.attr("aria-owns"),"aria-required":$input.attr("aria-required"),"autocomplete":$input.attr("autocomplete"),"role":$input.attr("role")};$input.attr({"aria-autocomplete":"list","aria-owns":self.$list.attr("id"),"autocomplete":"off","role":"combobox"});self.ajax=null;self.ajaxAborted=false;self.documentMouseup=null;self.focusPseudo=false;self.focusReal=false;self.mousedown=false;self.selectedData=null;self.selectedMouseup=false;self.timer=null;self.value=self.$input.val();self._bindInput()._bindList()._bindDocument();self._initSelected()._initOptions()},_setOption:function(option,value){$.Widget.prototype._setOption.apply(this,arguments);this._initOptions(option,value)},_initOptions:function(option,value){var self=this,allOptions=option===undefined,options={};if(allOptions){options=self.options}else{options[option]=value}$.each(options,function(option,value){switch(option){case"label":self.options.label=$(value).addClass("mp_label");if(self.options.label.attr("id")){self.removeLabelId=false}else{self.removeLabelId=true;self.options.label.attr("id",self.inputName+"_label")}self._toggleLabel();self.$input.attr("aria-labelledby",self.options.label.attr("id"));break;case"required":self.$input.attr("aria-required",value);break;case"selected":if(allOptions&&value){self.select(value,null,true)}break;case"url":if(!value){self.options.url=self.$input.closest("form").attr("action")}break}});return self},change:function(q,onlyValue){var self=this;if(q===self.value){return}if(q!==self.$input.val()){self.$input.val(q)}self.selectedData=null;self.value=q;self._trigger("change",[q]);if(onlyValue!==true){if(self.focusPseudo){self._cancelPendingRequest()._hideAndEmptyList()}else{self._toggleLabel()}}},search:function(q){var $input=this.$input;if(q!==undefined){$input.val(q)}$input.focus()},select:function(data,$item,initial){var self=this,$input=self.$input,hideOnSelect=self.options.hideOnSelect;if(hideOnSelect){self._hideList()}if(!data){return self.change("")}self.selectedData=data;self._trigger("select",[data,$item,!!initial]);if($input.val()!==self.value){self.value=$input.val();if(!self.focusPseudo){self._toggleLabel()}self._hideAndEmptyList()}},_initSelected:function(){var self=this,$input=self.$input,data=$input.data("selected"),value=$input.val();if(data){self.select(data,null,true)}else{if(value){self.select(value,null,true)}}return self},selected:function(){return this.selectedData},destroy:function(){var self=this,options=self.options,$input=self.$input;self.$list.remove();$.each(self.inputOriginals,function(attribute,value){if(value===undefined){$input.removeAttr(attribute)}else{$input.attr(attribute,value)}});$input.removeClass("mp_input");if(options.label){options.label.removeClass("mp_label");if(self.removeLabelId){options.label.removeAttr("id")}}$(document).unbind("mouseup.marcoPolo",self.documentMouseup);$.Widget.prototype.destroy.apply(self,arguments)},list:function(){return this.$list},_bindInput:function(){var self=this,$input=self.$input,$list=self.$list;$input.bind("focus.marcoPolo",function(){if(self.focusReal){return}self.focusPseudo=true;self.focusReal=true;self._toggleLabel();if(self.selectedMouseup){self.selectedMouseup=false}else{self._trigger("focus");self._request($input.val())}}).bind("keydown.marcoPolo",function(key){var $highlighted=$();
switch(key.which){case self.keys.UP:key.preventDefault();self._showList()._highlightPrev();break;case self.keys.DOWN:key.preventDefault();self._showList()._highlightNext();break;case self.keys.HOME:self._showList()._highlightFirst();break;case self.keys.END:self._showList()._highlightLast();break;case self.keys.ENTER:if(!$list.is(":visible")){if(!self.options.submitOnEnter){key.preventDefault()}return}$highlighted=self._highlighted();if($highlighted.length){self.select($highlighted.data("marcoPolo"),$highlighted)}if(!self.options.submitOnEnter||$highlighted.length){key.preventDefault()}break;case self.keys.TAB:if(!$list.is(":visible")){return}$highlighted=self._highlighted();if($highlighted.length){self.select($highlighted.data("marcoPolo"),$highlighted)}break;case self.keys.ESC:self._cancelPendingRequest()._hideList();break}}).bind("keyup.marcoPolo",function(){if($input.val()!==self.value){self._request($input.val())}}).bind("blur.marcoPolo",function(){self.focusReal=false;setTimeout(function(){if(!self.mousedown){self._dismiss()}},1)});return self},_bindList:function(){var self=this;self.$list.bind("mousedown.marcoPolo",function(){self.mousedown=true}).delegate("li.mp_selectable","mouseover",function(){self._addHighlight($(this))}).delegate("li.mp_selectable","mouseout",function(){self._removeHighlight($(this))}).delegate("li.mp_selectable","mouseup",function(){var $item=$(this);self.select($item.data("marcoPolo"),$item);self.selectedMouseup=true;self.$input.focus()});return self},_bindDocument:function(){var self=this;$(document).bind("mouseup.marcoPolo",self.documentMouseup=function(){self.mousedown=false;if(!self.focusReal&&self.$list.is(":visible")){self._dismiss()}});return self},_toggleLabel:function(){var self=this,$label=self.options.label;if($label&&$label.length){if(self.focusPseudo||self.$input.val()){$label.hide()}else{$label.show()}}return self},_firstSelectableItem:function(){return this.$list.children("li.mp_selectable:visible:first")},_lastSelectableItem:function(){return this.$list.children("li.mp_selectable:visible:last")},_highlighted:function(){return this.$list.children("li.mp_highlighted")},_removeHighlight:function($item){$item.removeClass("mp_highlighted").attr("aria-selected","false").removeAttr("id");this.$input.removeAttr("aria-activedescendant");return this},_addHighlight:function($item){this._removeHighlight(this._highlighted());$item.addClass("mp_highlighted").attr({"aria-selected":"true","id":this.inputName+"_highlighted"});this.$input.attr("aria-activedescendant",$item.attr("id"));return this},_highlightFirst:function(){this._addHighlight(this._firstSelectableItem());return this},_highlightLast:function(){this._addHighlight(this._lastSelectableItem());return this},_highlightPrev:function(){var $highlighted=this._highlighted(),$prev=$highlighted.prevAll("li.mp_selectable:visible:first");if(!$prev.length){$prev=this._lastSelectableItem()}this._addHighlight($prev);return this},_highlightNext:function(){var $highlighted=this._highlighted(),$next=$highlighted.nextAll("li.mp_selectable:visible:first");if(!$next.length){$next=this._firstSelectableItem()}this._addHighlight($next);return this},_showList:function(){if(this.$list.children().length){this.$list.show();this.$input.attr("aria-expanded","true")}return this},_hideList:function(){this.$list.hide();this.$input.removeAttr("aria-activedescendant").removeAttr("aria-expanded");return this},_emptyList:function(){this.$list.empty();this.$input.removeAttr("aria-activedescendant");return this},_hideAndEmptyList:function(){this.$list.hide().empty();this.$input.removeAttr("aria-activedescendant").removeAttr("aria-expanded");return this},_buildNoResultsList:function(q){var self=this,$input=self.$input,$list=self.$list,options=self.options,$item=$('<li class="mp_no_results" role="alert" />'),formatNoResults;formatNoResults=options.formatNoResults&&options.formatNoResults.call($input,q,$item);if(formatNoResults){$item.html(formatNoResults)}self._trigger("noResults",[q,$item]);if(formatNoResults){$item.appendTo($list);self._showList()}else{self._hideList()}return self},_buildResultsList:function(q,data){var self=this,$input=self.$input,$list=self.$list,options=self.options,selected=self.selectedData,compare=options.compare&&selected,compareCurrent,compareSelected,compareMatch=false,datum,$item=$(),formatItem;for(var i=0,length=data.length;i<length;i++){datum=data[i];$item=$('<li class="mp_item" />');formatItem=options.formatItem.call($input,datum,$item);$item.data("marcoPolo",datum);$item.html(formatItem).appendTo($list);if(compare&&options.highlight){if(options.compare===true){compareCurrent=datum;compareSelected=selected}else{compareCurrent=datum[options.compare];compareSelected=selected[options.compare]}if(compareCurrent===compareSelected){self._addHighlight($item);compare=false;compareMatch=true}}}$list.children(options.selectable).addClass("mp_selectable").attr({"aria-selected":"false","role":"option"});self._trigger("results",[data]);
self._showList();if(!compareMatch&&options.highlight){self._highlightFirst()}return self},_buildSuccessList:function(q,data){var self=this,$input=self.$input,options=self.options;self._emptyList();if(options.formatData){data=options.formatData.call($input,data)}if(!data||data.length===0||$.isEmptyObject(data)){self._buildNoResultsList(q)}else{self._buildResultsList(q,data)}return self},_buildErrorList:function(jqXHR,textStatus,errorThrown){var self=this,$input=self.$input,$list=self.$list,options=self.options,$item=$('<li class="mp_error" role="alert" />'),formatError;self._emptyList();formatError=options.formatError&&options.formatError.call($input,$item,jqXHR,textStatus,errorThrown);if(formatError){$item.html(formatError)}self._trigger("error",[$item,jqXHR,textStatus,errorThrown]);if(formatError){$item.appendTo($list);self._showList()}else{self._hideList()}return self},_buildMinCharsList:function(q){var self=this,$input=self.$input,$list=self.$list,options=self.options,$item=$('<li class="mp_min_chars" role="alert" />'),formatMinChars;if(!q.length){self._hideAndEmptyList();return self}self._emptyList();formatMinChars=options.formatMinChars&&options.formatMinChars.call($input,options.minChars,$item);if(formatMinChars){$item.html(formatMinChars)}self._trigger("minChars",[options.minChars,$item]);if(formatMinChars){$item.appendTo($list);self._showList()}else{self._hideList()}return self},_cancelPendingRequest:function(){var self=this;if(self.ajax){self.ajaxAborted=true;self.ajax.abort()}else{self.ajaxAborted=false}clearTimeout(self.timer);return self},_request:function(q){var self=this,$input=self.$input,$list=self.$list,options=self.options;self._cancelPendingRequest();self.change(q,true);self.timer=setTimeout(function(){var data={},param={},params={},cacheKey,$inputParent=$();if(q.length<options.minChars){self._buildMinCharsList(q);return self}data=$.isFunction(options.data)?options.data.call(self.$input,q):options.data;param[options.param]=q;params=$.extend({},data,param);cacheKey=options.url+(options.url.indexOf("?")===-1?"?":"&")+$.param(params);if(options.cache&&cache[cacheKey]){self._buildSuccessList(q,cache[cacheKey])}else{self._trigger("requestBefore");$inputParent=$input.parent().addClass("mp_busy");$list.attr("aria-busy","true");self.ajax=$.ajax({url:options.url,dataType:"json",data:params,success:function(data){self._buildSuccessList(q,data);if(options.cache){cache[cacheKey]=data}},error:function(jqXHR,textStatus,errorThrown){if(!self.ajaxAborted){self._buildErrorList(jqXHR,textStatus,errorThrown)}},complete:function(jqXHR,textStatus){self.ajax=null;self.ajaxAborted=false;$inputParent.removeClass("mp_busy");$list.attr("aria-busy","false");self._trigger("requestAfter",[jqXHR,textStatus])}})}},options.delay);return self},_dismiss:function(){var self=this,options=self.options;self.focusPseudo=false;self._cancelPendingRequest()._hideAndEmptyList();if(options.required&&!self.selectedData){self.change("",true)}self._toggleLabel()._trigger("blur");return self},_trigger:function(name,args){var self=this,callbackName="on"+name.charAt(0).toUpperCase()+name.slice(1),triggerName=self.widgetEventPrefix.toLowerCase()+name.toLowerCase(),triggerArgs=$.isArray(args)?args:[],callback=self.options[callbackName];self.element.trigger(triggerName,triggerArgs);return callback&&callback.apply(self.element,triggerArgs)}})}));